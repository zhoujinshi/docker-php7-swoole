#
# NOTE: THIS DOCKERFILE IS GENERATED VIA "update.sh"
#
# PLEASE DO NOT EDIT IT DIRECTLY.
#

FROM php:fpm-alpine3.9

LABEL maintainer="jinge <admin@cnbbx.com>" version="1.0"

ENV LANG zh_CN.UTF-8
ENV TIME_ZONE Asia/Shanghai
RUN echo "https://mirror.tuna.tsinghua.edu.cn/alpine/v3.9/main/" > /etc/apk/repositories && echo "https://mirror.tuna.tsinghua.edu.cn/alpine/v3.9/community/" >> /etc/apk/repositories \
    && apk update && apk add --no-cache -U tzdata \
    && cp /usr/share/zoneinfo/${TIME_ZONE} /etc/localtime && echo "${TIME_ZONE}" > /etc/timezone && apk del tzdata

RUN set -ex \
		&& docker-php-ext-install pdo_mysql mysqli opcache \
        && cd /usr/src \
		&& wget -O redis.tgz "http://pecl.php.net/get/redis-4.3.0.tgz" \
		&& wget -O xdebug.tgz "http://pecl.php.net/get/xdebug-2.7.2.tgz" \
        && ls -alh \
        && apk add --no-cache --virtual .phpize-deps $PHPIZE_DEPS \
        # php extension: redis
        && pecl install redis.tgz \
        && docker-php-ext-enable redis \
        # php extension: bcmath
        && docker-php-ext-install bcmath \
        # php extension: xdebug
        && pecl install xdebug.tgz \
		&& docker-php-ext-enable xdebug \
        # php extension: mongodb
        && pecl install mongodb \
        && docker-php-ext-enable mongodb \
		&& apk del .phpize-deps \
		&& echo "opcache.enable_cli=0" >>  /usr/local/etc/php/conf.d/docker-php-ext-opcache.ini \
		&& echo "log_errors = On" >> /usr/local/etc/php/conf.d/log.ini \
		&& echo "error_log=/dev/stderr" >> /usr/local/etc/php/conf.d/log.ini \
		&& echo "date.timezone=Asia/Shanghai" > /usr/local/etc/php/conf.d/date.ini \
		&& echo "xdebug.remote_enable=1" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.remote_host=127.0.0.1" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.remote_port=5800" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.remote_connect_back=0" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.profiler_enable=1" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.idekey=PHPSTORM" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& echo "xdebug.remote_log=/var/www/log/xdebug.log" >> /usr/local/etc/php/conf.d/xdebug.ini\
		&& rm /usr/src/*

EXPOSE 5800

ENTRYPOINT ["docker-php-entrypoint"]
##<autogenerated>##
CMD ["php", "-a"]
##</autogenerated>##